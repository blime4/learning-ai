<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>llama.cpp å­¦ä¹ è·¯çº¿å›¾</title>
<style>
  :root {
    --bg: #0d1117; --card: #161b22; --border: #30363d;
    --text: #e6edf3; --muted: #8b949e; --accent: #58a6ff;
    --green: #3fb950; --yellow: #d29922; --purple: #bc8cff;
    --red: #f85149; --orange: #f0883e;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; }

  .container { max-width: 960px; margin: 0 auto; padding: 24px 16px; }

  header { text-align: center; padding: 40px 0 32px; }
  header h1 { font-size: 2em; margin-bottom: 8px; }
  header h1 span { color: var(--accent); }
  header p { color: var(--muted); font-size: 0.95em; }

  /* Overall progress */
  .overall { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 20px 24px; margin-bottom: 32px; }
  .overall h2 { font-size: 1.1em; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
  .overall h2 .emoji { font-size: 1.3em; }
  .progress-bar { background: var(--border); border-radius: 8px; height: 20px; overflow: hidden; position: relative; }
  .progress-fill { height: 100%; border-radius: 8px; background: linear-gradient(90deg, var(--green), var(--accent)); transition: width 0.5s ease; }
  .progress-text { text-align: center; margin-top: 8px; color: var(--muted); font-size: 0.9em; }
  .stats { display: flex; gap: 24px; margin-top: 16px; flex-wrap: wrap; }
  .stat { display: flex; align-items: center; gap: 6px; font-size: 0.85em; color: var(--muted); }
  .stat .dot { width: 10px; height: 10px; border-radius: 50%; }

  /* Streak */
  .streak-bar { display: flex; align-items: center; gap: 12px; margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border); }
  .streak-bar .fire { font-size: 1.4em; }
  .streak-info { font-size: 0.85em; color: var(--muted); }
  .streak-info strong { color: var(--orange); font-size: 1.1em; }
  .streak-cal { display: flex; gap: 3px; margin-left: auto; }
  .streak-day { width: 14px; height: 14px; border-radius: 3px; background: var(--border); }
  .streak-day.active { background: var(--green); }
  .streak-day.today { outline: 2px solid var(--accent); }

  /* Phase */
  .phase { background: var(--card); border: 1px solid var(--border); border-radius: 12px; margin-bottom: 20px; overflow: hidden; }
  .phase-header { padding: 16px 20px; cursor: pointer; display: flex; align-items: center; gap: 12px; user-select: none; }
  .phase-header:hover { background: rgba(88,166,255,0.05); }
  .phase-icon { font-size: 1.3em; }
  .phase-title { flex: 1; font-size: 1em; font-weight: 600; }
  .phase-badge { font-size: 0.75em; padding: 2px 10px; border-radius: 12px; background: var(--border); color: var(--muted); }
  .phase-badge.done { background: rgba(63,185,80,0.15); color: var(--green); }
  .phase-arrow { color: var(--muted); transition: transform 0.3s; font-size: 0.8em; }
  .phase.open .phase-arrow { transform: rotate(90deg); }
  .phase-progress { height: 3px; background: var(--border); }
  .phase-progress-fill { height: 100%; background: var(--green); transition: width 0.4s; }
  .phase-body { display: none; padding: 0 20px 16px; }
  .phase.open .phase-body { display: block; }

  /* Item */
  .item { display: flex; align-items: flex-start; gap: 12px; padding: 10px 0; border-bottom: 1px solid var(--border); }
  .item:last-child { border-bottom: none; }
  .item input[type="checkbox"] { appearance: none; width: 20px; height: 20px; border: 2px solid var(--border); border-radius: 6px; cursor: pointer; flex-shrink: 0; margin-top: 2px; position: relative; transition: all 0.2s; }
  .item input[type="checkbox"]:checked { background: var(--green); border-color: var(--green); }
  .item input[type="checkbox"]:checked::after { content: 'âœ“'; position: absolute; top: -1px; left: 3px; color: #fff; font-size: 14px; font-weight: bold; }
  .item-num { color: var(--accent); font-weight: 700; font-size: 0.85em; min-width: 28px; margin-top: 2px; }
  .item-content { flex: 1; }
  .item-file { font-size: 0.85em; color: var(--purple); word-break: break-all; }
  .item-file a { color: var(--purple); text-decoration: none; }
  .item-file a:hover { text-decoration: underline; }
  .item-desc { font-size: 0.85em; color: var(--muted); margin-top: 2px; }
  .item.checked .item-file a { color: var(--muted); text-decoration: line-through; }
  .item.checked .item-desc { text-decoration: line-through; opacity: 0.6; }
  .item-date { font-size: 0.7em; color: var(--muted); margin-top: 4px; }

  /* Buttons */
  .actions { text-align: center; margin: 24px 0; display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; }
  .btn { padding: 8px 20px; border-radius: 8px; border: 1px solid var(--border); background: var(--card); color: var(--text); cursor: pointer; font-size: 0.85em; transition: all 0.2s; }
  .btn:hover { border-color: var(--accent); color: var(--accent); }
  .btn.danger:hover { border-color: var(--red); color: var(--red); }

  footer { text-align: center; padding: 32px 0; color: var(--muted); font-size: 0.8em; }
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>ğŸ¦™ <span>llama.cpp</span> å­¦ä¹ è·¯çº¿å›¾</h1>
    <p>46 ä¸ªçŸ¥è¯†ç‚¹ Â· 10 ä¸ªé˜¶æ®µ Â· ä»åŸºç¡€åˆ° Agent å…¨è¦†ç›–</p>
  </header>

  <div class="overall">
    <h2><span class="emoji">ğŸ“Š</span> æ€»ä½“è¿›åº¦</h2>
    <div class="progress-bar"><div class="progress-fill" id="overallFill" style="width:0%"></div></div>
    <div class="progress-text" id="overallText">0 / 48 å®Œæˆ (0%)</div>
    <div class="stats">
      <div class="stat"><span class="dot" style="background:var(--green)"></span> <span id="statDone">0</span> å·²å®Œæˆ</div>
      <div class="stat"><span class="dot" style="background:var(--border)"></span> <span id="statTodo">48</span> å¾…å­¦ä¹ </div>
      <div class="stat"><span class="dot" style="background:var(--accent)"></span> é¢„è®¡ <span id="statDays">48</span> å¤©</div>
    </div>
    <div class="streak-bar">
      <span class="fire">ğŸ”¥</span>
      <div class="streak-info">è¿ç»­å­¦ä¹  <strong id="streakCount">0</strong> å¤©</div>
      <div class="streak-cal" id="streakCal"></div>
    </div>
  </div>

  <div id="phases"></div>

  <div class="actions">
    <button class="btn" onclick="expandAll()">å±•å¼€å…¨éƒ¨</button>
    <button class="btn" onclick="collapseAll()">æŠ˜å å…¨éƒ¨</button>
    <button class="btn" onclick="exportProgress()">å¯¼å‡ºè¿›åº¦ JSON</button>
    <button class="btn" onclick="importProgress()">å¯¼å…¥è¿›åº¦</button>
    <button class="btn danger" onclick="resetAll()">é‡ç½®è¿›åº¦</button>
  </div>

  <footer>æ•°æ®ä¿å­˜åœ¨æµè§ˆå™¨ localStorage Â· åŸºäº <a href="https://github.com/blime4/learning-ai" style="color:var(--accent)">learning-ai</a> ä»“åº“</footer>
</div>

<script>
const REPO = 'https://github.com/blime4/learning-ai/blob/main/';
const PHASES = [
  {icon:'ğŸ—ï¸', title:'ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€ä¸ç¯å¢ƒæ­å»º', items:[
    {n:'1', files:['fundamentals/ggml/README.md'], desc:'GGML åº•å±‚å¼ é‡åº“ â€” tensorã€backendã€è®¡ç®—å›¾'},
    {n:'2', files:['fundamentals/llama.cpp/README.md'], desc:'é¡¹ç›®å…¥å£ï¼šå­æ¨¡å—é…ç½®ã€ç¼–è¯‘ã€GDB è°ƒè¯•ã€CUDA æ„å»º'},
    {n:'3', files:['notes/llama.cpp/debugging.md'], desc:'è°ƒè¯•æŠ€å·§'},
  ]},
  {icon:'âš™ï¸', title:'ç¬¬äºŒé˜¶æ®µï¼šæ ¸å¿ƒæ¦‚å¿µï¼ˆæ¨ç†æµæ°´çº¿ï¼‰', items:[
    {n:'4', files:['fundamentals/llama.cpp/src/tokenize.cpp','notes/llama.cpp/llama-vocab-notes.md'], desc:'åˆ†è¯å™¨ â€” æ¨ç†çš„ç¬¬ä¸€æ­¥'},
    {n:'5', files:['fundamentals/llama.cpp/src/simple-prompt.cpp'], desc:'æœ€ç®€å•çš„æ¨ç†ç¤ºä¾‹'},
    {n:'6', files:['notes/llama.cpp/llama-batch.md'], desc:'llama_batch / llama_ubatch ç»“æ„'},
    {n:'7', files:['notes/llama.cpp/process_ubatch.md'], desc:'micro-batch å¤„ç†ç»†èŠ‚'},
    {n:'8', files:['notes/llama.cpp/kv-cache.md'], desc:'KV ç¼“å­˜æœºåˆ¶ â€” æ¨ç†åŠ é€Ÿæ ¸å¿ƒ'},
    {n:'9', files:['fundamentals/llama.cpp/src/kv-cache.cpp'], desc:'KV ç¼“å­˜ä»£ç å®è·µ'},
    {n:'10', files:['notes/llama.cpp/graph-inputs.md'], desc:'è®¡ç®—å›¾è¾“å…¥æ„å»º'},
    {n:'11', files:['notes/llama.cpp/gpu-sampling.md'], desc:'GPU é‡‡æ ·ï¼ˆtemperatureã€top-kã€top-pï¼‰'},
    {n:'12', files:['notes/llama.cpp/output_ids.md'], desc:'è¾“å‡º token ID å¤„ç†'},
    {n:'13', files:['fundamentals/llama.cpp/src/simple-prompt-multi.cpp'], desc:'å¤š prompt æ‰¹å¤„ç†'},
  ]},
  {icon:'ğŸš€', title:'ç¬¬ä¸‰é˜¶æ®µï¼šGPU åŠ é€Ÿä¸åç«¯', items:[
    {n:'14', files:['notes/llama.cpp/cuda.md'], desc:'CUDA åç«¯åŠ è½½æœºåˆ¶'},
    {n:'15', files:['notes/llama.cpp/cuda-mul-mat.md'], desc:'CUDA çŸ©é˜µä¹˜æ³•'},
    {n:'16', files:['notes/llama.cpp/cuda-fp16-release-build-issue.md'], desc:'FP16 æ„å»ºé—®é¢˜'},
    {n:'17', files:['fundamentals/ggml/src/llama-att-softmax.cpp'], desc:'attention softmax GGML å®ç°'},
    {n:'18', files:['notes/llama.cpp/flash-attn-misalignment-issue.md'], desc:'Flash Attention å¯¹é½é—®é¢˜'},
    {n:'19', files:['notes/llama.cpp/macosx.md'], desc:'macOS (Metal) å¹³å°'},
    {n:'20', files:['notes/llama.cpp/ggml-threadpool-macos-issue.md'], desc:'çº¿ç¨‹æ± é—®é¢˜'},
  ]},
  {icon:'ğŸ“¦', title:'ç¬¬å››é˜¶æ®µï¼šæ¨¡å‹è½¬æ¢ä¸é‡åŒ–', items:[
    {n:'21', files:['notes/llama.cpp/convert.md'], desc:'convert_hf_to_gguf.py æµç¨‹'},
    {n:'22', files:['notes/llama.cpp/quantization.md'], desc:'é‡åŒ–åŸç†ä¸ QAT'},
    {n:'23', files:['notes/llama.cpp/convert-dequantize.md'], desc:'åé‡åŒ–è¿‡ç¨‹'},
    {n:'24', files:['notes/llama.cpp/devstral2-conversion.md'], desc:'Devstral2 è½¬æ¢å®ä¾‹'},
    {n:'25', files:['notes/llama.cpp/convert-mamba-issue.md'], desc:'Mamba è½¬æ¢é—®é¢˜'},
    {n:'26', files:['notes/llama.cpp/gemma-bos-issue.md'], desc:'Gemma BOS token é—®é¢˜'},
  ]},
  {icon:'ğŸ”¢', title:'ç¬¬äº”é˜¶æ®µï¼šEmbeddings', items:[
    {n:'27', files:['fundamentals/llama.cpp/src/embeddings.cpp'], desc:'embedding ç”Ÿæˆä»£ç '},
    {n:'28', files:['notes/llama.cpp/embeddings-presets.md'], desc:'embedding é¢„è®¾é…ç½®'},
  ]},
  {icon:'ğŸŒ', title:'ç¬¬å…­é˜¶æ®µï¼šServer ä¸éƒ¨ç½²', items:[
    {n:'29', files:['notes/llama.cpp/llama-server.md'], desc:'server å¯åŠ¨ä¸ API'},
    {n:'30', files:['notes/llama.cpp/server-checkpoints.md'], desc:'checkpoint ç®¡ç†'},
    {n:'31', files:['notes/llama.cpp/server-logprob-issue.md'], desc:'log probability é—®é¢˜'},
    {n:'32', files:['notes/llama.cpp/server-unit-tests.md'], desc:'server æµ‹è¯•'},
    {n:'33', files:['notes/llama.cpp/llama-perplexity.md'], desc:'å›°æƒ‘åº¦è®¡ç®—'},
    {n:'34', files:['notes/llama.cpp/tests.md'], desc:'æµ‹è¯•æ¡†æ¶'},
    {n:'35', files:['notes/llama.cpp/sbatch.md'], desc:'SLURM æ‰¹é‡æäº¤'},
  ]},
  {icon:'ğŸ¯', title:'ç¬¬ä¸ƒé˜¶æ®µï¼šFinetuning', items:[
    {n:'36', files:['fundamentals/llama.cpp/README.md'], desc:'LoRA å¾®è°ƒã€Shakespeareã€chat æ ¼å¼è®­ç»ƒ'},
  ]},
  {icon:'ğŸ‘ï¸', title:'ç¬¬å…«é˜¶æ®µï¼šå¤šæ¨¡æ€ä¸ç‰¹æ®Šæ¨¡å‹', items:[
    {n:'37', files:['notes/llama.cpp/llama-3-2-vision.md'], desc:'Llama 3.2 è§†è§‰æ¨¡å‹'},
    {n:'38', files:['notes/llama.cpp/qwen-2.5VL-3B-instruct.md'], desc:'Qwen è§†è§‰æ¨¡å‹'},
    {n:'39', files:['notes/llama.cpp/vision-model-issue.md'], desc:'è§†è§‰æ¨¡å‹é—®é¢˜'},
    {n:'40', files:['fundamentals/image-processing/src/mllama.cpp'], desc:'Llama è§†è§‰æ¨¡å‹å®ç°'},
    {n:'41', files:['notes/llama.cpp/tts.md'], desc:'TTS é›†æˆ'},
  ]},
  {icon:'ğŸ¤–', title:'ç¬¬ä¹é˜¶æ®µï¼šAgent ä¸ä¸Šå±‚åº”ç”¨', items:[
    {n:'42', files:['agents/llama-cpp-agent/README.md'], desc:'WASM agent æ¡†æ¶'},
    {n:'43', files:['agents/llama-cpp-agent/agent/src/main.rs','agents/llama-cpp-agent/agent/src/agent.rs','agents/llama-cpp-agent/agent/src/tool.rs'], desc:'Rust agent å®ç°'},
  ]},
  {icon:'ğŸ”—', title:'ç¬¬åé˜¶æ®µï¼šå…¶ä»–è¯­è¨€ç»‘å®šä¸é›†æˆ', items:[
    {n:'44', files:['fundamentals/python/src/llama-chat-format.py'], desc:'Python chat æ ¼å¼'},
    {n:'45', files:['fundamentals/rust/llm-chains-llama-example/README.md'], desc:'Rust LLM chains + Llama'},
    {n:'46', files:['fundamentals/rust/llm-chains-chat-demo/src/main-llama.rs'], desc:'Rust chat demo'},
  ]},
  {icon:'ğŸ“', title:'è¡¥å……ï¼šIssue ç¬”è®°', items:[
    {n:'A1', files:['notes/llama.cpp/sched-issue.md'], desc:'è°ƒåº¦é—®é¢˜'},
    {n:'A2', files:['notes/llama.cpp/update_chat_msg-issue.md'], desc:'chat æ¶ˆæ¯æ›´æ–°é—®é¢˜'},
  ]},
];

const STORAGE_KEY = 'llama-roadmap-progress';
const STREAK_KEY  = 'llama-roadmap-streak';

function load() { try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {}; } catch { return {}; } }
function save(d) { localStorage.setItem(STORAGE_KEY, JSON.stringify(d)); }
function loadStreak() { try { return JSON.parse(localStorage.getItem(STREAK_KEY)) || {dates:[]}; } catch { return {dates:[]}; } }
function saveStreak(s) { localStorage.setItem(STREAK_KEY, JSON.stringify(s)); }

function todayStr() { return new Date().toISOString().slice(0,10); }

function recordToday() {
  const s = loadStreak();
  const t = todayStr();
  if (!s.dates.includes(t)) { s.dates.push(t); s.dates.sort(); saveStreak(s); }
  updateStreak();
}

function calcStreak() {
  const s = loadStreak();
  if (!s.dates.length) return 0;
  let streak = 0;
  let d = new Date(); d.setHours(0,0,0,0);
  // check if today is in dates
  const tStr = todayStr();
  if (!s.dates.includes(tStr)) {
    d.setDate(d.getDate() - 1);
  }
  while (true) {
    const ds = d.toISOString().slice(0,10);
    if (s.dates.includes(ds)) { streak++; d.setDate(d.getDate()-1); }
    else break;
  }
  return streak;
}

function updateStreak() {
  document.getElementById('streakCount').textContent = calcStreak();
  // render last 14 days
  const cal = document.getElementById('streakCal');
  cal.innerHTML = '';
  const s = loadStreak();
  const t = todayStr();
  for (let i = 13; i >= 0; i--) {
    const d = new Date(); d.setDate(d.getDate() - i);
    const ds = d.toISOString().slice(0,10);
    const el = document.createElement('div');
    el.className = 'streak-day' + (s.dates.includes(ds) ? ' active' : '') + (ds === t ? ' today' : '');
    el.title = ds;
    cal.appendChild(el);
  }
}

function render() {
  const data = load();
  const container = document.getElementById('phases');
  container.innerHTML = '';
  let totalDone = 0, totalAll = 0;

  PHASES.forEach((phase, pi) => {
    const div = document.createElement('div');
    div.className = 'phase' + (pi < 2 ? ' open' : '');
    let phaseDone = 0;

    let itemsHtml = '';
    phase.items.forEach(item => {
      totalAll++;
      const key = 'item-' + item.n;
      const checked = data[key]?.done || false;
      const doneDate = data[key]?.date || '';
      if (checked) { phaseDone++; totalDone++; }
      const filesHtml = item.files.map(f => `<a href="${REPO}${f}" target="_blank">${f.split('/').pop()}</a>`).join(' / ');
      itemsHtml += `
        <div class="item ${checked?'checked':''}">
          <input type="checkbox" ${checked?'checked':''} data-key="${key}">
          <span class="item-num">#${item.n}</span>
          <div class="item-content">
            <div class="item-file">${filesHtml}</div>
            <div class="item-desc">${item.desc}</div>
            ${doneDate ? `<div class="item-date">âœ… ${doneDate}</div>` : ''}
          </div>
        </div>`;
    });

    const badgeClass = phaseDone === phase.items.length ? 'done' : '';
    const pct = phase.items.length ? Math.round(phaseDone / phase.items.length * 100) : 0;

    div.innerHTML = `
      <div class="phase-header" onclick="this.parentElement.classList.toggle('open')">
        <span class="phase-icon">${phase.icon}</span>
        <span class="phase-title">${phase.title}</span>
        <span class="phase-badge ${badgeClass}">${phaseDone}/${phase.items.length}</span>
        <span class="phase-arrow">â–¶</span>
      </div>
      <div class="phase-progress"><div class="phase-progress-fill" style="width:${pct}%"></div></div>
      <div class="phase-body">${itemsHtml}</div>`;
    container.appendChild(div);
  });

  // Update overall
  const pct = totalAll ? Math.round(totalDone / totalAll * 100) : 0;
  document.getElementById('overallFill').style.width = pct + '%';
  document.getElementById('overallText').textContent = `${totalDone} / ${totalAll} å®Œæˆ (${pct}%)`;
  document.getElementById('statDone').textContent = totalDone;
  document.getElementById('statTodo').textContent = totalAll - totalDone;
  document.getElementById('statDays').textContent = totalAll - totalDone;

  // Bind checkboxes
  document.querySelectorAll('.item input[type="checkbox"]').forEach(cb => {
    cb.addEventListener('change', function() {
      const d = load();
      const key = this.dataset.key;
      if (this.checked) {
        d[key] = { done: true, date: todayStr() };
        recordToday();
      } else {
        delete d[key];
      }
      save(d);
      render();
    });
  });

  updateStreak();
}

function expandAll() { document.querySelectorAll('.phase').forEach(p => p.classList.add('open')); }
function collapseAll() { document.querySelectorAll('.phase').forEach(p => p.classList.remove('open')); }

function exportProgress() {
  const d = { progress: load(), streak: loadStreak() };
  const blob = new Blob([JSON.stringify(d, null, 2)], {type:'application/json'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'llama-roadmap-progress.json';
  a.click();
}

function importProgress() {
  const input = document.createElement('input');
  input.type = 'file'; input.accept = '.json';
  input.onchange = e => {
    const f = e.target.files[0]; if (!f) return;
    const r = new FileReader();
    r.onload = ev => {
      try {
        const d = JSON.parse(ev.target.result);
        if (d.progress) save(d.progress);
        if (d.streak) saveStreak(d.streak);
        render();
        alert('å¯¼å…¥æˆåŠŸï¼');
      } catch { alert('JSON æ ¼å¼é”™è¯¯'); }
    };
    r.readAsText(f);
  };
  input.click();
}

function resetAll() {
  if (!confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰å­¦ä¹ è¿›åº¦å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚')) return;
  localStorage.removeItem(STORAGE_KEY);
  localStorage.removeItem(STREAK_KEY);
  render();
}

render();
</script>
</body>
</html>
